# 第一章 开端：语法与基础

## 0·总结

## 1·造一个简单计算器：数值(number)的四则运算(运算符)

&emsp;没有了计算功能，计算机就会失去灵魂。我们不难想象，大型程序是由一个个计算语句组成。所以，我们探索 CovScript 的第一步将从简单的四则运算开始。  
&emsp;运行以下代码，它作用是：将a的值打印到屏幕。  

```java {class=line-numbers}
using system
var a = 16
out.print(a)
```

&emsp;在解读这段代码前，我们先了解一些知识：  

```java
var a = 16
```

**var** 是 variable（变量）的缩写，`var`关键字表示声明变量，变量的类型由`=`后的内容决定。  
变量在所有编程语言中都占有举足轻重的地位，几乎所有数据在编程语言中都需要由变量来保存。我们可以将变量理解为“杯子”，而内容（数据）被“装”在杯子里。 

CovScript 对这段代码的执行流程是：  
> 我们声明了变量`a`，并向变量`a`中“装入”了一个值为 16 的数据，CovScript 自动将 16 识别为数值类型。至此，我们得到了一个数值类变量`a`，**目前**它的值为 16。

```java
out.print(a)
```

而在之前的 hello word 演示代码中，我们知道`out.print()`是可以向屏幕打印内容的。只是这里打印的是变量的内容，而变量是不需要加双引号的。  


不同的变量对应了不同的用途以及数据结构，虽然它们都是用`var`关键字进行创建，但是在具体操作中还是会因为变量类型不同而产生不同的情况，CovScript中常见的部分变量类型有这些：
|变量名|中文名|含义|例子|
|--|--|--|--|
|number|数值类型|表达全体实数（即整数、小数、无理数的集合）|3.41|
|boolean|逻辑类型|只有true（真）和false（假）两种类型，表达的是逻辑关系上的正确和错误|true<br>false|
|char|字符类型|表达的是单个字符，赋值时候通过**单引号**括起的单个字符为其赋值，可以是数字，大小写英文，标点符号，以及转义序列表示的特殊符号。<br>例如`var mychar = 'a'`代表将`a`这个字符赋值与`mycha`r变量|'A'<br>'a'<br>'?'<br>'\n' (代表换行的转义符）|
|string|字符串类型|由**双引号**括起的任意个数字符|"hello world"
|...|...|...|...|
&emsp;在代码运行过程中可以通过`type`来确定某个变量的类型

```python
type(a) # 这样它就会返回对应的变量类型

# 在非解释器中，可以通过这种方式来展示
out.print(type(a))
```
&emsp;对于以上的代码，会输出`cs::number`,代表变量a是一个number类型的变量。
<br></br>
&emsp;让我们回到刚才的程序
```java {class=line-numbers}
using system
var a = 16
out.print(a)
```
&emsp;细心的读者可能会发现：之所以说目前`a`的值为 16，是因为变量还可以进行更改。  
&emsp;现在，我们尝试用赋值语句来修改`a`的值。向之前的代码添加一句：  

```java {class=line-numbers}
using system
var a = 16
a = a + 4
out.print(a)
```

&emsp;显而易见，代码的运行结果为 20。  
&emsp;我们再聊聊赋值语句：  

```java
a = a + 4
```

对于此处的加法，此处理解为数学意义上的加法。  
几乎所有编程语言的**赋值语句**都设计得大同小异：我们以人类阅读从左至右的习惯，读出这行话为“a 等于 a 加 4”。不难猜出，赋值语句是要让程序将`a`的值变为`a + 4`。  
进一步解释，赋值语句是要将 = 右侧内容，写入 = 左侧内容，从而改变左侧变量的值。  
CovScript 对这段代码的执行流程是：  

> CovScript 先计算 = 右侧的值，再将a的值修改为右侧计算出的值

**值得注意的是**：这里的 4 可不是变量。4 就是常理中认为的 4，好比一升水就是一升水，我们并没有说这是“某瓶里的一升水”。因此这里的“水”可以没有“瓶子”，也就不是变量——但“不是瓶子里的水”并不会影响“装瓶”，不是变量的 4 也不会影响计算加法与赋值。  
<br></br>
&emsp;有了 var 关键字和赋值语句，我们可以完成最简单的加法计算器了！虽然它只能计算固定数值（以下是计算 16 + 3 的和）。  

```java{class=line-numbers}
using system
var a = 16, b = 3
var c = a + b
out.print(c)
```

如果想要加入输入的功能，只需使用 **in.input()** 的语句。此代码会从键盘读入两个数，输出它们的和。这样，加法计算器就完成了！同理你可以完成减法，乘除法的计算器。  

```java {class=line-numbers}
using system
var a = new number, b = new number, c = new number
a = in.input(); b = in.input();
c = a + b
out.print(c)
```

`new number`意为：当前并不想为此变量赋值（因为要在之后取输入值），但又必须指明该变量是何种类型。此时可以使用`new`关键字指明该变量类型为`number`。试想，声明的变量只是较为简单的 number，可以使用诸如 var a = 123 等来表示 a 的类型，所幸 123 的内容并不多。如若声明更为复杂的类型，不使用 new 关键字来表示声明变量的类型，将会写出很冗长的代码。 

in.input()会将从键盘读入的内容返回给 CovScript，你只需要用赋值语句，也就是 = 号，将输入的内容“送”给你的变量。  

**值得注意的是：** 第 3 行代码中，每句句尾添加了引号`;`，它的作用和中文中的句号类似，表示一句话的结束。这是因为 CovScript 会默认将一行代码识别为一条语句，如果一定要将多句写入一行，你需要手动为它们标记语句的结束。  

&emsp;聪明的读者会发现两个细节：第 2 行的连续声明，和第 3 行的声明。也许会因此将赋值和变量声明联想在一起（毕竟它们都有 = 号）——它们的确有关系，但现在并不适合阐述，你只要会用就行了。但你仍可以在wiki上发现关于变量初始化的细节，和赋值的定义。  

## 2·计算器进一步优化：判断(if, ?:)和字符串(string)

&emsp;让我们再仔细想想，如果仅用上一节提及的知识制作除法计算器的不完美之处：它在运算除法时并不会检测除数是否为 0，但合格的计算器需要这个功能。  
&emsp;本节我们来为除法计算器添加此功能。  
```java {class=line-numbers}
using system
var a = new number, b = new number, c = new number
a = in.input(); b = in.input();
if b==0
    out.print("error: can not divide 0.")
    exit(0)
else
    c = a / b
    out.print(c)
end
```
我们使用 **if else** 来实现判断功能。  
**if 判断的格式为**：

```java
if 条件表达式
    代码块 1
else
    代码块 2
end
```

if 与其后的判断条件使用空格隔开。如果条件表达式为真，则执行 if 后的`代码块1`；反之执行 else 后的`代码块2`，并以 end 作为整个条件判断的结尾。  
第 6 行的 **exit(0)** 表示执行到此时，结束整个程序。  

&emsp;一个简易的除法计算器完成了！但有挑剔的读者可能会觉得上面的错误信息不够详细。是的，我们可以做得更详细，但取而代之的是更长的字符串。比如除以 0 的时候，我们希望告诉用户，到底哪个数不能除以 0。
&emsp;为了更美观地使用字符串，我们可以定义一个名叫“错误信息”字符串，以增加代码的复用程度。  
部分代码如下：  

```java {class=line-numbers}
...
var err_info = new string
err_info = "error, the zero can not divided by "
...
if b == 0
    out.print(err_info + a)
end
```

在解释以上代码片段前，先介绍基础的字符串相关知识：  
字符串的类型名为**string**，支持使用加号 **+** 拼接前后两个字符串。  
比如，我们可以令`var str = "hello" + " " + "world"`，那么 str 的值将是 "hello world"。  
对以上代码片段，我们仅对 out.print() 里的内容做解释。  

> 在`out.print()`中`err_info`被视为字符串，而本该为`number`类型的`a`也被视为字符串。实际上，`a`在这里被转换了成了 `string` 类型。  

如果你这些解释存在疑虑，也许后面的内容能立刻解答你的疑惑。不妨抱着疑虑继续往下读。

<br></br>

&emsp;如果要把除法功能做的更严谨，我们知道除以 0 时是可以产生无穷大的。进一步，我们默认 0 / 0 中，除数与被除数同阶，那么 0 / 0 将为 1 。  
&emsp;实现这种做法，需要使用嵌套的循环，以达到分类讨论的效果。  
```java {class=line-numbers}
using system
var a = new number, b = new number, c = new number
a = in.input(); b = in.input();
if b == 0
    if a > 0
        c = "+inf"
    end
    if a  == 0
        c = 1
    end
    if a < 0
        c = "-inf"
    end
else
    c = a / b
end
out.print(c)
```

像如上的结构，称之为 if 的嵌套结构。你可以在任何位置嵌套使用 if。显然，if 判断可以没有 else（即条件为假则不执行任何内容）。  
第 4 行中的`==`符号意为判断两个值是否相等（因为 = 号意为赋值，故设计语言时采用 == 号）。  
也许有读者对第 6 行有所疑问：为什么一个 number 类型的变量，却能等于一个字符串呢？这是因为 CovScript 是动态强类型语言，变量的类型在初次声明之后是可以被更改的。  

&emsp;对于上面的代码，我们还能简化  

```java {class=line-numbers}
using system
var a = new number, b = new number, c = new number
a = in.input(); b = in.input();
if b == 0
    if a  == 0
        c = 1
    else
        c = a>0 ? "+inf" : "-inf"
    end
else
    c = a / b
end
out.print(c)
```
解释代码前，我们先介绍一中功能和 if 类似的语句：**三目表达式**。  
**三目表达式的格式为：** 

```java
条件表达式 : 表达式1 ? 表达式2
```
它的值取决于条件表达式。条件表达式为真，则三目表达式的值为 表达式1，否则为 表达式2。  

让我们再回到以上代码的逻辑：  

>在 b 为 0 的情况下，如果 a 为 0，则 c = 1，如果 a 不为 0，则为 c 根据情况进行赋值：当 a > 0 时，c 为 "+inf"，否则为 "-inf"。

涉及到以条件取值时，可以使用三目表达式，这样可以极大地简化代码量，而不必重复地写 if 语句。  

## 3·增加数列求和计算、科学计算等功能：循环(for, while, loop)与常量(constant)

&emsp;到目前为止，我们的计算器也只能每次进行一次运算，如果我们想进行批量的运算呢？比如说数列的求和。  
&emsp;尽管许多数列有各自的求和公式，但为了计算器的普遍适应，这里我们不采用求和公式，而是将数列中的每一个元素逐次相加求和。  

如果你没有学过数列，也没关系，下面是数列的简单定义：  
> 数列（sequence）是一列有序的数。数列中的每一个数都叫做这个数列的项。第 0 个数称为第 0 项，第 1 个数称为第 1 项，第 n 个数称为第 n 项。通常第 0 项又称首项。

&emsp;最朴素的思路是：利用循环，逐次将每一项计算一次加法，将总和记录下来。代码如下。  

```java {class=line-numbers}
using system

var sum = 0, n = new number
n = in.input()

var i = 0 
while i < n
    var a_i = in.input()
    sum += a_i
    i++
end

out.print("the sum of sequence = "+sum)
```

我们使用了 **while 循环** 来达到循环执行代码的目的。  
**while 循环格式为：**  

```java
while 条件表达式
    语句块
end
```

> 当条件表达式为真时，便执行一次语句块。每当执行完一次语句块，便会判断条件表达式是否仍然成立。直至条件表达式为假，从 end 处退出 while 循环。  

&emsp;我们来看代码，首先我们读入了一个变量 n，代表此数列由 n 个元素构成。接下来每次循环中执行相应的操作。  
&emsp;控制循环次数最常用的手段之一，便是使用循环控制变量。此处我们用 i（index的缩写） 来表示循环变量。每执行一次循环，便在第 10 行使 i++。 `i++` 是 `i = i + 1` 的简便写法。  
&emsp;而对于每次循环，我们都将读入 a_i，然后将 sum 累加上 a_i。这样，经过循环累加的 sum 便是此次数列的总和。`sum += a_i` 是 `sum = sum + a_i` 的简便写法。  
&emsp;最后，我们使用 + 号将字符串 "the sum of sequence = " 与刚才求到的总和 sum 拼接在一起。  
**注意：** 这里的 + 号不是加法意义上的加号，而是字符串的拼接。还记得上一节我们提到的动态类型吗？实际上在 out.print() 里，所有类将变成字符串类，你可以按需求将它们拼接。（事实上这是我第二次强调字符串拼接了）

当然，类似的写法还有 loop until 循环。
```vb {class=line-numbers}
var sum = 0, n = new number
n = in.input()
var i = 0
loop
    var a_i = in.input()
    sum += a_i
    i++
until i >= n
end
```
**loop until 循环格式为：**
```vb
loop
    语句块
until 条件表达式
```
> 执行完语句块后，如果不满足条件表达式，则回到 loop，继续执行语句块。

**注意：** while 循环和 loop 循环的区别不仅在于执行取决于条件的真假，而且一个是先判断后执行，另一个是执行完后判断。
你甚至可以去掉 until 一行，转而用 end 关键字替代，这样就变成了 loop end 循环，需要手动设计代码跳出。

&emsp;既然使用循环变量来控制循环次数是如此常见的套路，有没有专门为循环变量设计的循环语句呢？就像备胎是那么常见，乃至产生了许多为放下备胎而设计的汽车。
&emsp;for 循环也许能让您满意。

```java {class=line-numbers}
using system

var sum = 0, n = new number
n = in.input()

for i = 0, i < n , i++
    var a_i = in.input()
    sum += a_i
end

out.print("the sum of sequence = "+sum)
```

**for 循环的格式为：**
```java
for 循环变量 = 初始值, 条件表达式， 后处理表达式
    语句块
end
```
不难发现，for 循环的设计刚好满足了普通计数循环的需求：一个循环变量，每次执行完循环对循环变量的更改，以及所有循环都有的判断条件。
> 首次执行 for 循环时，for 会帮你创建一个**仅用于当前 for 循环**的循环变量，不管是否会进入循环，都会为其赋初始值；满足条件表达式则进入循环体，执行一次循环；在执行完语句块所有代码后，执行后处理表达式，并进入下一次循环的条件判断。  

**注意：** 除了赋初值的行为只会在首次运行 for 循环时发生，其余两种行为则会在每次循环的始末执行。  

也许至此，有读者认为我们还是不能彻底掌控循环（尤其是会使用汇编语言的读者）。CovScript 还提供了控制语句，以便随心所欲地掌控你的循环。  
**break 语句：** 立即跳出当前循环。break 语句格式为：  
```vb
任意循环语句
    break
end
```
**continue 语句：** 立即结束此轮循环，进而执行下一轮循环。continue 语句格式为：  
```vb
任意循环语句
    continue
end
```
**注意：** continue 和 break 只允许在循环体中的语句块内编写。  

<br></br>

&emsp;也许以上的数列计算太过娱乐了，那么我们再来做一些科学计算会使用到的功能。比如，一些计算器会有 exp(x) 功能，它表示计算 $e^x$ 。下面是自然常数 e 的介绍。  

> e，自然常数，为数学中一个常数，是一个无限不循环小数，且为超越数，其值约为2.718281828459045。

让我们写一个 exp(x) 的功能。

```php {class=line-numbers}
using system
constant e = 2.71
var x = in.input()
out.print(e^x)
```
其中，`constant`是对常量的声明。你可以理解为与变量相对应的概念：不可更改的量。使用常量，可以防止你的代码更改常用的定值。当然，这个习惯的好处这不仅仅如此。

&emsp;同理，你现在能写出拥有圆的周长、面积计算功能的计算器了。

## 4·功能整合——完善你的多功能计算器：分支(switch)与函数(function)



## 5·矩阵计算器——解放线性代数作业：数组(array)

## 6·来数钱！超市收银台：综合运用
